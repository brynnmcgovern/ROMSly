<!DOCTYPE html>
<html>
<head>
    <!-- INJECTED HEADER -->
    <meta name="viewport" content="width=device-width,maximum-scale=2">
    <link rel="icon" type="image/x-icon" href="/blockly-samples/favicon.ico" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic,500,500italic,700,700italic" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://blocklycodelabs.dev/styles/main.css" />
    <link rel="stylesheet" href="/blockly-samples/css/custom.css"/>
    <!-- END INJECTED HEADER -->

    <meta charset="utf-8">
    <title>ROMSly</title>
    <!-- <script src="https://unpkg.com/blockly/blockly.min.js"></script> -->
    <script src="https://unpkg.com/blockly/blockly_compressed.js"></script>
    <script src="https://unpkg.com/blockly/blocks_compressed.js"></script>
    <script src="https://unpkg.com/blockly/javascript_compressed.js"></script>
    <script src="https://unpkg.com/blockly/python_compressed.js"></script>
    <script src="https://unpkg.com/blockly/msg/en.js"></script>

    <script src="./custom_blocks.js"></script>

    <style>
        body {
        background-color: #fff;
        font-family: sans-serif;
        }
        h1 {
        font-weight: normal;
        font-size: 140%;
        }
    </style>
</head>
<body>
    <!-- NAV BAR -->
    <nav id="toolbar">
        <a href="/blockly-samples" id="arrow-back">
        <i class="material-icons">close</i>
        <img src="https://blocklycodelabs.dev/images/logo_knockout.png" class="logo-devs"
            alt="Blockly sample" />
        </a>

        <div class="title-grow">
        <div class="title">Generate JavaScript</div>
        <div class="subtitle">Turn blocks into code and execute it.</div>
        </div>
        
        <a href="https://github.com/google/blockly-samples/blob/master/examples/generator-demo" class="button" target="_blank">View code</a>
    </nav>
    <!-- END NAV BAR -->

    <p>This is a simple demo of generating code from blocks and running
    the code using eval.</p>
    
    <p>&rarr; More info on <a href="https://developers.google.com/blockly/guides/configure/web/code-generators">Code Generators</a> and <a href="https://developers.google.com/blockly/guides/app-integration/running-javascript">Running JavaScript</a>.</p>
    
    <p>
        <button onclick="showCode()">Show JavaScript</button>
        <button onclick="runCode()">Run JavaScript</button>
    </p>
    
    <div id="blocklyDiv" style="height: 480px; width: 600px; border: #000; border-width: 1px;"></div>
    <xml id="toolbox" style="display: none">
        <block type="food_item"></block>
        <block type="drink_item"></block>
        <block type="combo_item"></block>
        <block type="identifier"></block>
        <block type="single_order"></block>
        <block type="math_arithmetic"></block>
    </xml>
      
    <script>
        // var toolbox = document.getElementById('toolbox')

        var workspace = Blockly.inject('blocklyDiv',
        {media: 'https://unpkg.com/blockly/media/',
         toolbox: document.getElementById('toolbox')});

        // Blockly.serialization.workspaces.load(startBlocks, workspace);

        function showCode() {
        // Generate JavaScript code and display it.
        javascript.javascriptGenerator.INFINITE_LOOP_TRAP = null;
        var code = javascript.javascriptGenerator.workspaceToCode(workspace);
        alert(code);
        }

        function runCode() {
        // Generate JavaScript code and run it.
        window.LoopTrap = 1000;
        javascript.javascriptGenerator.INFINITE_LOOP_TRAP =
            'if (--window.LoopTrap < 0) throw "Infinite loop.";\n';
        var code = javascript.javascriptGenerator.workspaceToCode(workspace);
        javascript.javascriptGenerator.INFINITE_LOOP_TRAP = null;
        try {
            eval(code);
        } catch (e) {
            alert(e);
        }
        }

    </script>
</body>
</html>
